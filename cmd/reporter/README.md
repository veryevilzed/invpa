# Утилита пакетного анализа инвойсов `reporter`

`reporter` — это консольная утилита для автоматической обработки всех файлов инвойсов (PDF, PNG, JPG) в директории, их анализа, дедупликации контрагентов и создания итогового Excel-отчета.

## Возможности

-   Сканирует текущую директорию на наличие инвойсов.
-   Отображает красивый прогресс-бар во время обработки.
-   Использует AI для "умного" сопоставления и дедупликации контрагентов.
-   Создает Excel-файл `__RESULT.xlsx` с тремя листами:
    1.  **Invoices**: Список всех успешно разобранных инвойсов.
    2.  **Counterparties**: Список уникальных контрагентов с присвоенными ID.
    3.  **Errors**: Список файлов, которые не удалось обработать, с описанием ошибок.

---

## Инструкция по установке и запуску для Windows

### Шаг 1: Установка Go

Go — это язык программирования, на котором написана утилита.

1.  **Скачайте установщик:** Перейдите на [официальный сайт Go](https://go.dev/dl/) и скачайте MSI установщик для Windows.
2.  **Установите Go:** Запустите скачанный файл и следуйте инструкциям на экране. Установщик автоматически добавит Go в системную переменную `PATH`.
3.  **Проверьте установку:** Откройте `Командную строку` (Command Prompt) или `PowerShell` и выполните команду:
    ```sh
    go version
    ```
    Вы должны увидеть версию Go, например: `go version go1.21.5 windows/amd64`.

### Шаг 2: Установка Poppler (для обработки PDF)

Poppler — это библиотека, необходимая для извлечения изображений из PDF-файлов. Для Windows есть два способа настройки:

#### Способ А: Указание пути в `config.json` (Рекомендуемый)

1.  **Скачайте Poppler:** Последние сборки для Windows можно найти [здесь](https://github.com/oschwartz10612/poppler-windows/releases/). Скачайте архив, например, `poppler-23.11.0-0.zip`.
2.  **Распакуйте архив:** Распакуйте содержимое архива в постоянное место на вашем компьютере, например, `C:\poppler`.
3.  **Настройте `config.json`:**
    *   Откройте файл `config.json` в корне проекта.
    *   Найдите поле `poppler_path_windows` и укажите в нем путь к папке `bin` внутри директории Poppler. **Важно:** используйте прямые слэши `/`.
        ```json
        "poppler_path_windows": "C:/poppler/bin"
        ```

#### Способ Б: Добавление Poppler в системный PATH

Если вы предпочитаете не указывать путь в конфиге, вы можете добавить Poppler в переменные среды Windows.

1.  **Скачайте и распакуйте Poppler**, как описано в шагах 1-2 Способа А.
2.  **Добавьте Poppler в PATH:**
    *   Нажмите `Win + R`, введите `sysdm.cpl` и нажмите Enter.
    *   Перейдите на вкладку "Дополнительно" и нажмите "Переменные среды".
    *   В разделе "Системные переменные" найдите и выберите переменную `Path`, затем нажмите "Изменить".
    *   Нажмите "Создать" и вставьте путь к папке `bin`. Например: `C:\poppler\bin`.
    *   Нажмите "OK" во всех окнах, чтобы сохранить изменения.
3.  **Проверьте установку:** Откройте **новую** командную строку и выполните `pdftoppm -v`. Если вы видите информацию о версии, все настроено правильно.

### Шаг 3: Настройка проекта

1.  **Скачайте или клонируйте проект.**
2.  **Настройте `config.json`:**
    *   В корневой директории проекта переименуйте `config.json.example` в `config.json`.
    *   Откройте `config.json` и вставьте ваш API-ключ от OpenAI в поле `openai_api_key`.
    *   При необходимости укажите путь к Poppler, как описано в Шаге 2.

### Шаг 4: Сборка и запуск утилиты

#### Способ А: Использование Makefile (Рекомендуемый)

Если у вас установлен `make` (обычно доступен в Git Bash, WSL или после установки через Chocolatey/Scoop), вы можете легко собрать проект для разных систем.

1.  **Откройте терминал** в корневой папке проекта.
2.  **Выполните одну из команд:**
    *   Собрать для Windows: `make build-windows`
    *   Собрать для macOS: `make build-mac`
    *   Собрать для вашей текущей ОС: `make build`
3.  Готовые файлы появятся в папке `build/windows` или `build/mac`.

#### Способ Б: Ручная сборка

1.  **Откройте терминал** в корневой папке проекта.
2.  **Соберите исполняемый файл** командой:
    *   Для Windows: `go build -o reporter.exe ./cmd/reporter`
    *   Для macOS/Linux: `go build -o reporter ./cmd/reporter`
3.  Исполняемый файл появится в корневой папке проекта.

### Шаг 5: Запуск

1.  **Поместите файлы инвойсов** (PDF, JPG и т.д.) в ту же папку, где находится ваш исполняемый файл (`reporter.exe` или `reporter`).
2.  **Запустите утилиту** из терминала:
    *   Windows: `.\reporter.exe`
    *   macOS/Linux: `./reporter`
3.  **Получите результат:** После завершения работы в этой же папке появится файл `__RESULT.xlsx` с результатами анализа.
