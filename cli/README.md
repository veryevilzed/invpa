# Консольная утилита `invpa-cli`

`invpa-cli` - это утилита командной строки для быстрого анализа файлов инвойсов прямо из терминала. Она использует библиотеку `invpa` для выполнения основной работы.

## Требования

-   **Go 1.18+** для сборки.
-   **Poppler:** Утилита `pdftoppm` должна быть установлена в системе. Инструкции по установке см. в [основном README.md](../README.md).

## 1. Конфигурация

Перед первым запуском необходимо настроить утилиту.

1.  **Создайте файл `config.json`:** В корневой директории проекта (`invpa`) переименуйте файл `config.json.example` в `config.json`.

2.  **Настройте параметры:** Откройте `config.json` и заполните его:
    -   `openai_api_key`: Вставьте ваш секретный ключ OpenAI.
    -   `my_company`: Укажите данные вашей компании. Эта информация используется для того, чтобы AI не перепутал вашу компанию с контрагентом при анализе инвойса.

    **Пример `config.json`:**
    ```json
    {
      "openai_api_key": "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxx",
      "my_company": {
        "name": "My Awesome Company LLC",
        "vat": "123456789",
        "country": "USA",
        "address": "123 Main St, Anytown, USA"
      }
    }
    ```

## 2. Сборка

Для сборки исполняемого файла выполните следующую команду из корневой директории проекта:

```bash
go build -o invpa-cli ./cli
```

В результате в корне проекта появится исполняемый файл `invpa-cli`.

## 3. Использование

Запустите утилиту, передав ей путь к файлу инвойса в качестве единственного аргумента.

### Синтаксис

```bash
./invpa-cli [путь_к_файлу]
```

### Примеры

-   **Анализ PDF файла:**
    ```bash
    ./invpa-cli /путь/к/вашему/счету.pdf
    ```

-   **Анализ изображения:**
    ```bash
    ./invpa-cli invoices/receipt.png
    ```

### Вывод

Утилита выводит результат анализа в стандартный поток вывода (stdout) в формате JSON. Если в одном файле будет найдено несколько инвойсов, будет выведен массив JSON-объектов.

**Пример вывода:**
```json
[
  {
    "type": 1,
    "number": "INV-2023-10-27",
    "date": "2023-10-27",
    "total_amount": 599.99,
    "tax_amount": 30,
    "purpose": "Подписка на сервис",
    "counterparty": {
      "name": "ООО 'Облачные Решения'",
      "vat": "7712345678",
      "country": "Россия",
      "address": "г. Москва, ул. Центральная, д. 10",
      "email": "info@cloud-solutions.com"
    }
  }
]
